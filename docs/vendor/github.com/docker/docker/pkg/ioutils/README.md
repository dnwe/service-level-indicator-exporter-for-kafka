<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# ioutils

```go
import "github.com/docker/docker/pkg/ioutils"
```

## Index

- [Variables](<#variables>)
- [func AtomicWriteFile(filename string, data []byte, perm os.FileMode) error](<#func-atomicwritefile>)
- [func NewAtomicFileWriter(filename string, perm os.FileMode) (io.WriteCloser, error)](<#func-newatomicfilewriter>)
- [func NewCancelReadCloser(ctx context.Context, in io.ReadCloser) io.ReadCloser](<#func-newcancelreadcloser>)
- [func NewReadCloserWrapper(r io.Reader, closer func() error) io.ReadCloser](<#func-newreadcloserwrapper>)
- [func NewReaderErrWrapper(r io.Reader, closer func()) io.Reader](<#func-newreadererrwrapper>)
- [func NewWriteCloserWrapper(r io.Writer, closer func() error) io.WriteCloser](<#func-newwritecloserwrapper>)
- [func NopWriteCloser(w io.Writer) io.WriteCloser](<#func-nopwritecloser>)
- [func TempDir(dir, prefix string) (string, error)](<#func-tempdir>)
- [type AtomicWriteSet](<#type-atomicwriteset>)
  - [func NewAtomicWriteSet(tmpDir string) (*AtomicWriteSet, error)](<#func-newatomicwriteset>)
  - [func (ws *AtomicWriteSet) Cancel() error](<#func-atomicwriteset-cancel>)
  - [func (ws *AtomicWriteSet) Commit(target string) error](<#func-atomicwriteset-commit>)
  - [func (ws *AtomicWriteSet) FileWriter(name string, flag int, perm os.FileMode) (io.WriteCloser, error)](<#func-atomicwriteset-filewriter>)
  - [func (ws *AtomicWriteSet) String() string](<#func-atomicwriteset-string>)
  - [func (ws *AtomicWriteSet) WriteFile(filename string, data []byte, perm os.FileMode) error](<#func-atomicwriteset-writefile>)
- [type BytesPipe](<#type-bytespipe>)
  - [func NewBytesPipe() *BytesPipe](<#func-newbytespipe>)
  - [func (bp *BytesPipe) Close() error](<#func-bytespipe-close>)
  - [func (bp *BytesPipe) CloseWithError(err error) error](<#func-bytespipe-closewitherror>)
  - [func (bp *BytesPipe) Read(p []byte) (n int, err error)](<#func-bytespipe-read>)
  - [func (bp *BytesPipe) Write(p []byte) (int, error)](<#func-bytespipe-write>)
- [type NopFlusher](<#type-nopflusher>)
  - [func (f *NopFlusher) Flush()](<#func-nopflusher-flush>)
- [type NopWriter](<#type-nopwriter>)
  - [func (*NopWriter) Write(buf []byte) (int, error)](<#func-nopwriter-write>)
- [type OnEOFReader](<#type-oneofreader>)
  - [func (r *OnEOFReader) Close() error](<#func-oneofreader-close>)
  - [func (r *OnEOFReader) Read(p []byte) (n int, err error)](<#func-oneofreader-read>)
- [type ReadCloserWrapper](<#type-readcloserwrapper>)
  - [func (r *ReadCloserWrapper) Close() error](<#func-readcloserwrapper-close>)
- [type WriteCounter](<#type-writecounter>)
  - [func NewWriteCounter(w io.Writer) *WriteCounter](<#func-newwritecounter>)
  - [func (wc *WriteCounter) Write(p []byte) (count int, err error)](<#func-writecounter-write>)
- [type WriteFlusher](<#type-writeflusher>)
  - [func NewWriteFlusher(w io.Writer) *WriteFlusher](<#func-newwriteflusher>)
  - [func (wf *WriteFlusher) Close() error](<#func-writeflusher-close>)
  - [func (wf *WriteFlusher) Flush()](<#func-writeflusher-flush>)
  - [func (wf *WriteFlusher) Flushed() bool](<#func-writeflusher-flushed>)
  - [func (wf *WriteFlusher) Write(b []byte) (n int, err error)](<#func-writeflusher-write>)


## Variables

```go
var (
    // ErrClosed is returned when Write is called on a closed BytesPipe.
    ErrClosed = errors.New("write to closed BytesPipe")
)
```

## func AtomicWriteFile

```go
func AtomicWriteFile(filename string, data []byte, perm os.FileMode) error
```

AtomicWriteFile atomically writes data to a file named by filename.

## func NewAtomicFileWriter

```go
func NewAtomicFileWriter(filename string, perm os.FileMode) (io.WriteCloser, error)
```

NewAtomicFileWriter returns WriteCloser so that writing to it writes to a temporary file and closing it atomically changes the temporary file to destination path. Writing and closing concurrently is not allowed.

## func NewCancelReadCloser

```go
func NewCancelReadCloser(ctx context.Context, in io.ReadCloser) io.ReadCloser
```

NewCancelReadCloser creates a wrapper that closes the ReadCloser when the context is cancelled. The returned io.ReadCloser must be closed when it is no longer needed.

## func NewReadCloserWrapper

```go
func NewReadCloserWrapper(r io.Reader, closer func() error) io.ReadCloser
```

NewReadCloserWrapper returns a new io.ReadCloser.

## func NewReaderErrWrapper

```go
func NewReaderErrWrapper(r io.Reader, closer func()) io.Reader
```

NewReaderErrWrapper returns a new io.Reader.

## func NewWriteCloserWrapper

```go
func NewWriteCloserWrapper(r io.Writer, closer func() error) io.WriteCloser
```

NewWriteCloserWrapper returns a new io.WriteCloser.

## func NopWriteCloser

```go
func NopWriteCloser(w io.Writer) io.WriteCloser
```

NopWriteCloser returns a nopWriteCloser.

## func TempDir

```go
func TempDir(dir, prefix string) (string, error)
```

TempDir on Unix systems is equivalent to os.MkdirTemp.

## type AtomicWriteSet

AtomicWriteSet is used to atomically write a set of files and ensure they are visible at the same time. Must be committed to a new directory.

```go
type AtomicWriteSet struct {
    // contains filtered or unexported fields
}
```

### func NewAtomicWriteSet

```go
func NewAtomicWriteSet(tmpDir string) (*AtomicWriteSet, error)
```

NewAtomicWriteSet creates a new atomic write set to atomically create a set of files. The given directory is used as the base directory for storing files before commit. If no temporary directory is given the system default is used.

### func \(\*AtomicWriteSet\) Cancel

```go
func (ws *AtomicWriteSet) Cancel() error
```

Cancel cancels the set and removes all temporary data created in the set.

### func \(\*AtomicWriteSet\) Commit

```go
func (ws *AtomicWriteSet) Commit(target string) error
```

Commit moves all created files to the target directory. The target directory must not exist and the parent of the target directory must exist.

### func \(\*AtomicWriteSet\) FileWriter

```go
func (ws *AtomicWriteSet) FileWriter(name string, flag int, perm os.FileMode) (io.WriteCloser, error)
```

FileWriter opens a file writer inside the set. The file should be synced and closed before calling commit.

### func \(\*AtomicWriteSet\) String

```go
func (ws *AtomicWriteSet) String() string
```

String returns the location the set is writing to.

### func \(\*AtomicWriteSet\) WriteFile

```go
func (ws *AtomicWriteSet) WriteFile(filename string, data []byte, perm os.FileMode) error
```

WriteFile writes a file to the set, guaranteeing the file has been synced.

## type BytesPipe

BytesPipe is io.ReadWriteCloser which works similarly to pipe\(queue\). All written data may be read at most once. Also, BytesPipe allocates and releases new byte slices to adjust to current needs, so the buffer won't be overgrown after peak loads.

```go
type BytesPipe struct {
    // contains filtered or unexported fields
}
```

### func NewBytesPipe

```go
func NewBytesPipe() *BytesPipe
```

NewBytesPipe creates new BytesPipe, initialized by specified slice. If buf is nil, then it will be initialized with slice which cap is 64. buf will be adjusted in a way that len\(buf\) == 0, cap\(buf\) == cap\(buf\).

### func \(\*BytesPipe\) Close

```go
func (bp *BytesPipe) Close() error
```

Close causes further reads from a BytesPipe to return immediately.

### func \(\*BytesPipe\) CloseWithError

```go
func (bp *BytesPipe) CloseWithError(err error) error
```

CloseWithError causes further reads from a BytesPipe to return immediately.

### func \(\*BytesPipe\) Read

```go
func (bp *BytesPipe) Read(p []byte) (n int, err error)
```

Read reads bytes from BytesPipe. Data could be read only once.

### func \(\*BytesPipe\) Write

```go
func (bp *BytesPipe) Write(p []byte) (int, error)
```

Write writes p to BytesPipe. It can allocate new \[\]byte slices in a process of writing.

## type NopFlusher

NopFlusher represents a type which flush operation is nop.

```go
type NopFlusher struct{}
```

### func \(\*NopFlusher\) Flush

```go
func (f *NopFlusher) Flush()
```

Flush is a nop operation.

## type NopWriter

NopWriter represents a type which write operation is nop.

```go
type NopWriter struct{}
```

### func \(\*NopWriter\) Write

```go
func (*NopWriter) Write(buf []byte) (int, error)
```

## type OnEOFReader

OnEOFReader wraps an io.ReadCloser and a function the function will run at the end of file or close the file.

```go
type OnEOFReader struct {
    Rc  io.ReadCloser
    Fn  func()
}
```

### func \(\*OnEOFReader\) Close

```go
func (r *OnEOFReader) Close() error
```

Close closes the file and run the function.

### func \(\*OnEOFReader\) Read

```go
func (r *OnEOFReader) Read(p []byte) (n int, err error)
```

## type ReadCloserWrapper

ReadCloserWrapper wraps an io.Reader, and implements an io.ReadCloser It calls the given callback function when closed. It should be constructed with NewReadCloserWrapper

```go
type ReadCloserWrapper struct {
    io.Reader
    // contains filtered or unexported fields
}
```

### func \(\*ReadCloserWrapper\) Close

```go
func (r *ReadCloserWrapper) Close() error
```

Close calls back the passed closer function

## type WriteCounter

WriteCounter wraps a concrete io.Writer and hold a count of the number of bytes written to the writer during a "session". This can be convenient when write return is masked \(e.g., json.Encoder.Encode\(\)\)

```go
type WriteCounter struct {
    Count  int64
    Writer io.Writer
}
```

### func NewWriteCounter

```go
func NewWriteCounter(w io.Writer) *WriteCounter
```

NewWriteCounter returns a new WriteCounter.

### func \(\*WriteCounter\) Write

```go
func (wc *WriteCounter) Write(p []byte) (count int, err error)
```

## type WriteFlusher

WriteFlusher wraps the Write and Flush operation ensuring that every write is a flush. In addition, the Close method can be called to intercept Read/Write calls if the targets lifecycle has already ended.

```go
type WriteFlusher struct {
    // contains filtered or unexported fields
}
```

### func NewWriteFlusher

```go
func NewWriteFlusher(w io.Writer) *WriteFlusher
```

NewWriteFlusher returns a new WriteFlusher.

### func \(\*WriteFlusher\) Close

```go
func (wf *WriteFlusher) Close() error
```

Close closes the write flusher, disallowing any further writes to the target. After the flusher is closed, all calls to write or flush will result in an error.

### func \(\*WriteFlusher\) Flush

```go
func (wf *WriteFlusher) Flush()
```

Flush the stream immediately.

### func \(\*WriteFlusher\) Flushed

```go
func (wf *WriteFlusher) Flushed() bool
```

Flushed returns the state of flushed. If it's flushed, return true, or else it return false.

### func \(\*WriteFlusher\) Write

```go
func (wf *WriteFlusher) Write(b []byte) (n int, err error)
```



Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
