<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# otelhttp

```go
import "go.opentelemetry.io/contrib/instrumentation/net/http/otelhttp"
```

Package otelhttp provides an http.Handler and functions that are intended to be used to add tracing by wrapping existing handlers \(with Handler\) and routes WithRouteTag.

## Index

- [Constants](<#constants>)
- [Variables](<#variables>)
- [func Get(ctx context.Context, url string) (resp *http.Response, err error)](<#func-get>)
- [func Head(ctx context.Context, url string) (resp *http.Response, err error)](<#func-head>)
- [func NewHandler(handler http.Handler, operation string, opts ...Option) http.Handler](<#func-newhandler>)
- [func Post(ctx context.Context, url, contentType string, body io.Reader) (resp *http.Response, err error)](<#func-post>)
- [func PostForm(ctx context.Context, url string, data url.Values) (resp *http.Response, err error)](<#func-postform>)
- [func SemVersion() string](<#func-semversion>)
- [func Version() string](<#func-version>)
- [func WithRouteTag(route string, h http.Handler) http.Handler](<#func-withroutetag>)
- [type Filter](<#type-filter>)
- [type Handler](<#type-handler>)
  - [func (h *Handler) ServeHTTP(w http.ResponseWriter, r *http.Request)](<#func-handler-servehttp>)
- [type Labeler](<#type-labeler>)
  - [func LabelerFromContext(ctx context.Context) (*Labeler, bool)](<#func-labelerfromcontext>)
  - [func (l *Labeler) Add(ls ...attribute.KeyValue)](<#func-labeler-add>)
  - [func (l *Labeler) Get() []attribute.KeyValue](<#func-labeler-get>)
- [type Option](<#type-option>)
  - [func WithClientTrace(f func(context.Context) *httptrace.ClientTrace) Option](<#func-withclienttrace>)
  - [func WithFilter(f Filter) Option](<#func-withfilter>)
  - [func WithMessageEvents(events ...event) Option](<#func-withmessageevents>)
  - [func WithMeterProvider(provider metric.MeterProvider) Option](<#func-withmeterprovider>)
  - [func WithPropagators(ps propagation.TextMapPropagator) Option](<#func-withpropagators>)
  - [func WithPublicEndpoint() Option](<#func-withpublicendpoint>)
  - [func WithSpanNameFormatter(f func(operation string, r *http.Request) string) Option](<#func-withspannameformatter>)
  - [func WithSpanOptions(opts ...trace.SpanStartOption) Option](<#func-withspanoptions>)
  - [func WithTracerProvider(provider trace.TracerProvider) Option](<#func-withtracerprovider>)
- [type Transport](<#type-transport>)
  - [func NewTransport(base http.RoundTripper, opts ...Option) *Transport](<#func-newtransport>)
  - [func (t *Transport) RoundTrip(r *http.Request) (*http.Response, error)](<#func-transport-roundtrip>)


## Constants

Attribute keys that can be added to a span.

```go
const (
    ReadBytesKey  = attribute.Key("http.read_bytes")  // if anything was read from the request body, the total number of bytes read
    ReadErrorKey  = attribute.Key("http.read_error")  // If an error occurred while reading a request, the string of the error (io.EOF is not recorded)
    WroteBytesKey = attribute.Key("http.wrote_bytes") // if anything was written to the response writer, the total number of bytes written
    WriteErrorKey = attribute.Key("http.write_error") // if an error occurred while writing a reply, the string of the error (io.EOF is not recorded)
)
```

Server HTTP metrics

```go
const (
    RequestCount          = "http.server.request_count"           // Incoming request count total
    RequestContentLength  = "http.server.request_content_length"  // Incoming request bytes total
    ResponseContentLength = "http.server.response_content_length" // Incoming response bytes total
    ServerLatency         = "http.server.duration"                // Incoming end to end duration, microseconds
)
```

## Variables

DefaultClient is the default Client and is used by Get, Head, Post and PostForm. Please be careful of intitialization order \- for example, if you change the global propagator, the DefaultClient might still be using the old one

```go
var DefaultClient = &http.Client{Transport: NewTransport(http.DefaultTransport)}
```

## func Get

```go
func Get(ctx context.Context, url string) (resp *http.Response, err error)
```

Get is a convenient replacement for http.Get that adds a span around the request.

## func Head

```go
func Head(ctx context.Context, url string) (resp *http.Response, err error)
```

Head is a convenient replacement for http.Head that adds a span around the request.

## func NewHandler

```go
func NewHandler(handler http.Handler, operation string, opts ...Option) http.Handler
```

NewHandler wraps the passed handler, functioning like middleware, in a span named after the operation and with any provided Options.

## func Post

```go
func Post(ctx context.Context, url, contentType string, body io.Reader) (resp *http.Response, err error)
```

Post is a convenient replacement for http.Post that adds a span around the request.

## func PostForm

```go
func PostForm(ctx context.Context, url string, data url.Values) (resp *http.Response, err error)
```

PostForm is a convenient replacement for http.PostForm that adds a span around the request.

## func SemVersion

```go
func SemVersion() string
```

SemVersion is the semantic version to be supplied to tracer/meter creation.

## func Version

```go
func Version() string
```

Version is the current release version of the otelhttp instrumentation.

## func WithRouteTag

```go
func WithRouteTag(route string, h http.Handler) http.Handler
```

WithRouteTag annotates a span with the provided route name using the RouteKey Tag.

## type Filter

Filter is a predicate used to determine whether a given http.request should be traced. A Filter must return true if the request should be traced.

```go
type Filter func(*http.Request) bool
```

## type Handler

Handler is http middleware that corresponds to the http.Handler interface and is designed to wrap a http.Mux \(or equivalent\), while individual routes on the mux are wrapped with WithRouteTag. A Handler will add various attributes to the span using the attribute.Keys defined in this package.

```go
type Handler struct {
    // contains filtered or unexported fields
}
```

### func \(\*Handler\) ServeHTTP

```go
func (h *Handler) ServeHTTP(w http.ResponseWriter, r *http.Request)
```

ServeHTTP serves HTTP requests \(http.Handler\)

## type Labeler

Labeler is used to allow instrumented HTTP handlers to add custom attributes to the metrics recorded by the net/http instrumentation.

```go
type Labeler struct {
    // contains filtered or unexported fields
}
```

### func LabelerFromContext

```go
func LabelerFromContext(ctx context.Context) (*Labeler, bool)
```

LabelerFromContext retrieves a Labeler instance from the provided context if one is available.  If no Labeler was found in the provided context a new, empty Labeler is returned and the second return value is false.  In this case it is safe to use the Labeler but any attributes added to it will not be used.

### func \(\*Labeler\) Add

```go
func (l *Labeler) Add(ls ...attribute.KeyValue)
```

Add attributes to a Labeler.

### func \(\*Labeler\) Get

```go
func (l *Labeler) Get() []attribute.KeyValue
```

Get returns a copy of the attributes added to the Labeler.

## type Option

Option interface used for setting optional config properties.

```go
type Option interface {
    // contains filtered or unexported methods
}
```

### func WithClientTrace

```go
func WithClientTrace(f func(context.Context) *httptrace.ClientTrace) Option
```

WithClientTrace takes a function that returns client trace instance that will be applied to the requests sent through the otelhttp Transport.

### func WithFilter

```go
func WithFilter(f Filter) Option
```

WithFilter adds a filter to the list of filters used by the handler. If any filter indicates to exclude a request then the request will not be traced. All filters must allow a request to be traced for a Span to be created. If no filters are provided then all requests are traced. Filters will be invoked for each processed request, it is advised to make them simple and fast.

### func WithMessageEvents

```go
func WithMessageEvents(events ...event) Option
```

WithMessageEvents configures the Handler to record the specified events \(span.AddEvent\) on spans. By default only summary attributes are added at the end of the request.

Valid events are: \* ReadEvents: Record the number of bytes read after every http.Request.Body.Read using the ReadBytesKey \* WriteEvents: Record the number of bytes written after every http.ResponeWriter.Write using the WriteBytesKey

### func WithMeterProvider

```go
func WithMeterProvider(provider metric.MeterProvider) Option
```

WithMeterProvider specifies a meter provider to use for creating a meter. If none is specified, the global provider is used.

### func WithPropagators

```go
func WithPropagators(ps propagation.TextMapPropagator) Option
```

WithPropagators configures specific propagators. If this option isn't specified, then the global TextMapPropagator is used.

### func WithPublicEndpoint

```go
func WithPublicEndpoint() Option
```

WithPublicEndpoint configures the Handler to link the span with an incoming span context. If this option is not provided, then the association is a child association instead of a link.

### func WithSpanNameFormatter

```go
func WithSpanNameFormatter(f func(operation string, r *http.Request) string) Option
```

WithSpanNameFormatter takes a function that will be called on every request and the returned string will become the Span Name

### func WithSpanOptions

```go
func WithSpanOptions(opts ...trace.SpanStartOption) Option
```

WithSpanOptions configures an additional set of trace.SpanOptions, which are applied to each new span.

### func WithTracerProvider

```go
func WithTracerProvider(provider trace.TracerProvider) Option
```

WithTracerProvider specifies a tracer provider to use for creating a tracer. If none is specified, the global provider is used.

## type Transport

Transport implements the http.RoundTripper interface and wraps outbound HTTP\(S\) requests with a span.

```go
type Transport struct {
    // contains filtered or unexported fields
}
```

### func NewTransport

```go
func NewTransport(base http.RoundTripper, opts ...Option) *Transport
```

NewTransport wraps the provided http.RoundTripper with one that starts a span and injects the span context into the outbound request headers.

If the provided http.RoundTripper is nil, http.DefaultTransport will be used as the base http.RoundTripper

### func \(\*Transport\) RoundTrip

```go
func (t *Transport) RoundTrip(r *http.Request) (*http.Response, error)
```

RoundTrip creates a Span and propagates its context via the provided request's headers before handing the request to the configured base RoundTripper. The created span will end when the response body is closed or when a read from the body returns io.EOF.



Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
